<ng-template #add_card_modal let-c="close" let-d="dismiss">    
    <div class="modal-header">
        <h5 class="modal-title" style="font-weight: bold" *ngIf="type == types.Task || type == types.ProjectTask">Cadastrar Tarefa</h5>
        <h5 class="modal-title" style="font-weight: bold" *ngIf="type == types.Project">Cadastrar Projeto</h5>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">			
        <div class="form-body">			
            <div class="row">
                <div class="col-12">                    
                    <fieldset class="form-group">	                        					                        
                        <label for="card_operator"                             
                            style="font-weight: bold"
                            *ngIf="card.parent">
                            Responsável
                        </label>		
                        <div class="form-group">                            	
                            <select id="card_operator" 
                                name="card_operator"
                                class="form-control"
                                [(ngModel)]="card.leaders" 
                                [compareWith]="entity_compare"
                                (ngModelChange)="validate_new_card()">			
                                <option></option>			
                                <option *ngFor="let op of operators" [ngValue]="op">{{ op.name }}</option>
                            </select>								
                        </div>
                        <label for="card_operator"                             
                            style="font-weight: bold">
                            Local
                        </label>		
                        <div class="form-group">                            	
                            <select id="card_location" 
                                name="card_location"
                                class="form-control"
                                [(ngModel)]="card.locations[0]" 
                                [compareWith]="entity_compare"
                                (ngModelChange)="validate_new_card()">			                                		
                                <option *ngFor="let l of locations" [ngValue]="l">{{ l.name }}</option>
                            </select>								                                    
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <label for="card_template">Tipo</label>                                                									
                                <div class="input-group">							
                                        <select id="card_template" 
                                        name="card_template"
                                        [(ngModel)]="card.template"                                 																	
                                        class="form-control"
                                        [compareWith]="entity_compare"	
                                        (ngModelChange)="validate_new_card()"							
                                        >			                                        			
                                        <option *ngFor="let tpl of templates" [ngValue]="tpl">{{ tpl.name }}</option>
                                    </select>                                    
                                </div>
                            </div>
                        </div>
                        <div class="row" *ngIf="card.template && card.template.require_target_group">
                            <div class="col-12">
                                <label for="card_group">Grupo</label>                                                									
                                <div class="input-group">							
                                        <select id="card_group" 
                                        name="card_group"
                                        [(ngModel)]="card.group"                                 																	
                                        class="form-control"
                                        [compareWith]="entity_compare"	
                                        (ngModelChange)="validate_new_card()"							
                                        >			                                        			
                                        <option *ngFor="let tpl of groups" [ngValue]="tpl">{{ tpl.name }}</option>
                                    </select>                                    
                                </div>
                            </div>
                        </div>
                        <div class="row" *ngIf="card.group && card.group.need_branch">
                            <div class="col-12">
                                <label for="card_branch">Subgrupo</label>                                                									
                                <div class="input-group">							
                                        <select id="card_branch" 
                                        name="card_branch"
                                        [(ngModel)]="card.branch"                                 																	
                                        class="form-control"
                                        [compareWith]="entity_compare"
                                        (ngModelChange)="validate_new_card()"								
                                        >	
                                        <option *ngIf="card.group.allow_no_branch">Pessoas sem núcleo definido</option>		                                        			
                                        <option *ngFor="let tpl of branches" [ngValue]="tpl">{{ tpl.name }}</option>
                                    </select>                                    
                                </div>
                            </div>
                        </div>
                        <div class="row" *ngIf="card.template && card.template.require_target">
                            <div class="col-12">
                                <label for="card_people">Quem</label>                                                									
                                <ul *ngIf="card.people != null && card.people.length > 0"
                                    class="list-group">
                                    <li *ngFor="let p of card.people"
                                        class="list-group-item">
                                        <img alt="{{ p.name }}" 
                                        class="img-border" 
                                        src="https://myvtmiim.blob.core.windows.net/avatars/{{ p.avatar_url }}" 											
                                        style="min-width:50px;max-width:50px;" 
                                        *ngIf="p.avatar_url && p.avatar_url.length > 0" />							
                                        {{ p.name }}
                                        <div style="float:right;cursor: pointer;" 
                                            title="Remover pessoa da atividade"
                                            (click)="remove_person_from_new_card(p)">
                                            <span class="badge badge-pill">
                                                <i class="fa fa-times"                                                                         
                                                ></i>
                                            </span>
                                        </div>
                                    </li>						
                                </ul>												
                                <div class="form-group" [class.has-danger]="search_failed">
                                <input type="text" class="form-control" 
                                    id="new_incident_search_people"
                                    [ngbTypeahead]="search_people" 
                                    placeholder="Pesquise {{ card.people == null || card.people.length <= 0 ? 'o' : 'mais' }} participante{{ card.people == null || card.people.length <= 0 ? '' : 's' }}"
                                    [resultTemplate]="person_typeahead_template"
                                    [inputFormatter]="people_typeahead_formatter"
                                    [(ngModel)]="card.tmp_person" 
                                    (ngModelChange) ="add_person_to_new_card($event)" 
                                />
                                <span *ngIf="searching_people">buscando...</span>
                                <div class="form-control-feedback" *ngIf="search_failed">
                                    ops... ocorreu algum erro na busca</div>
                                </div>
                                <ng-template #person_typeahead_template let-p="result">
                                    <img alt="{{ p.name }}" 
                                    class="img-border" 
                                    src="https://myvtmiim.blob.core.windows.net/avatars/{{ p.avatar_url }}" 											
                                    style="min-width:50px;max-width:50px;" 
                                    *ngIf="p.avatar_url && p.avatar_url.length > 0" />						
                                    {{ p.name }}
                                    <span *ngIf="!p.found" style="font-style: italic;">
                                        (novo)
                                    </span>
                                </ng-template>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <label for="card_title">Título</label>                                                									
                                <div class="input-group">							
                                    <input class="form-control"
                                    [(ngModel)]="card.title"
                                    (ngModelChange)="validate_new_card()"
                                    autocomplete="off"
                                    id="card_title"
                                    name="card_title"/>                                    
                                </div>
                            </div>
                        </div>
                                                
                        <div class="row">
                            <div class="col-12 col-md-6">
                                <label for="card_due_date">Previsão</label>                                                									
                                <div class="input-group">							
                                    <input class="form-control text-center" placeholder="dd/mm/aaaa" 
                                    [(ngModel)]="card.due_date" 
                                    id="card_due_date"
                                    name="card_due_date"
                                    autocomplete="off"
                                    ngbDatepicker #niDueDateDate="ngbDatepicker" />
                                    <div class="input-group-addon" (click)="niDueDateDate.toggle()">
                                        <i class="ft-calendar" style="cursor: pointer;"></i>
                                    </div>
                                </div>
                            </div>                            
                        </div>                                            

                        <label for="card_description"                             
                            style="font-weight: bold">
                            Descrição
                        </label>		
                        <div class="form-group">
                            <textarea class="form-control"
                            id="card_description"
                            autocomplete="off"
                            [(ngModel)]="card.description" 		
                            rows="3"></textarea>								
                        </div>                                                            				
                    </fieldset>                                
                </div>
            </div>                        
            <div class="row" *ngIf="!card_is_valid">
                <div class="col-12 text-danger">
                    <ul>
                        <li style="line-height:1.2em" *ngFor="let error of card_validation">{{ error }}</li>
                    </ul>                    
                </div>
            </div>
        </div>			
    </div>
    <div class="modal-footer" *ngIf="saving">        
        <i class="fas fa-circle-notch fa-spin"></i> &nbsp; Executando...
    </div>
    <div class="modal-footer" *ngIf="!saving">
        <button type="button" 
            class="btn btn-success" 
            (click)="register_new_card();"
            *ngIf="card_is_valid">            
            <i class="icon-check"></i>
            Cadastrar            
        </button>															
        <button type="button" class="btn btn-silver" 
            (click)="d('close new person!');"
            >
            <i class="icon-action-undo"></i>
            Cancelar
        </button>	
    </div>
</ng-template>